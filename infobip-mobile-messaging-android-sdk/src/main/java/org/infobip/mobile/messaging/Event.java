package org.infobip.mobile.messaging;

import android.content.BroadcastReceiver;

/**
 * Enumerates all events generated by the Mobile Messaging library.
 * It is intended to be used in <i>BroadcastReceivers</i> registered locally or at the application level.
 * <p>
 * You can register receivers in AndroidManifest.xml by adding:
 * <pre>
 * {@code <receiver android:name=".MyMessageReceiver" android:exported="false">
 *       <intent-filter>
 *           <action android:name="org.infobip.mobile.messaging.MESSAGE_RECEIVED"/>
 *        </intent-filter>
 *   </receiver>}
 * </pre>
 * <p>
 * You can also register receivers in you Activity by adding:
 * <pre>
 * {@code
 * public class MyActivity extends AppCompatActivity {
 *        private boolean isReceiverRegistered;
 *        private BroadcastReceiver messageReceiver = new BroadcastReceiver() {
 *            public void onReceive(Context context, Intent intent) {
 *                Message message = new Message(intent.getExtras());
 *                ... process your message here
 *            }
 *        };
 *
 *        protected void onCreate(Bundle savedInstanceState) {
 *            super.onCreate(savedInstanceState);
 *
 *            registerReceiver();
 *        }
 *
 *        protected void onResume() {
 *            super.onResume();
 *            registerReceiver();
 *        }
 *
 *        protected void onPause() {
 *            LocalBroadcastManager.getInstance(this).unregisterReceiver(messageReceiver);
 *            isReceiverRegistered = false;
 *            super.onPause();
 *        }
 *
 *        private void registerReceiver() {
 *            if (isReceiverRegistered) {
 *                return;
 *            }
 *            LocalBroadcastManager.getInstance(this).registerReceiver(messageReceiver,
 *            new IntentFilter(Event.MESSAGE_RECEIVED.getKey()));
 *            isReceiverRegistered = true;
 *        }
 *    }}
 * </pre>
 *
 * @author mstipanov
 * @see BroadcastReceiver
 * @see Event#TOKEN_RECEIVED
 * @see Event#REGISTRATION_CREATED
 * @see Event#INSTALLATION_UPDATED
 * @see Event#USER_UPDATED
 * @see Event#MESSAGE_RECEIVED
 * @see Event#MESSAGES_SENT
 * @see Event#NOTIFICATION_DISPLAYED
 * @see Event#NOTIFICATION_TAPPED
 * @see Event#USER_SESSIONS_SENT
 * @see Event#CUSTOM_EVENTS_SENT
 * @see Event#PERSONALIZED
 * @see Event#DEPERSONALIZED
 * @see Event#DELIVERY_REPORTS_SENT
 * @see Event#API_COMMUNICATION_ERROR
 * @see Event#GOOGLE_PLAY_SERVICES_ERROR
 * @since 01.03.2016.
 */
public enum Event {
    /**
     * It is triggered when FCM registration token is received.
     * <p>
     * Contains the FCM registration token.
     * <pre>
     * {@code
     * String fcmRegistrationToken = intent.getStringExtra(BroadcastParameter.EXTRA_CLOUD_TOKEN);
     * }
     * </pre>
     */
    TOKEN_RECEIVED("org.infobip.mobile.messaging.TOKEN_RECEIVED"),

    /**
     * It is triggered when FCM registration token is successfully stored on the server.
     * <p>
     * Contains the FCM registration token, Infobip device application instance ID and system data in installation
     * (which identifies every application instance).
     * <pre>
     * {@code
     * Installation installation = Installation.createFrom(intent.getExtras());
     * }
     * </pre>
     */
    REGISTRATION_CREATED("org.infobip.mobile.messaging.REGISTRATION_CREATED"),

    /**
     * It is triggered when installation is successfully reported to the server.
     * <pre>
     * {@code
     * Installation installation = Installation.createFrom(intent.getExtras());
     * }
     * </pre>
     */
    INSTALLATION_UPDATED("org.infobip.mobile.messaging.INSTALLATION_UPDATED"),

    /**
     * It is triggered when message is received.
     * <p>
     * Contains the received message information.
     * <pre>
     * {@code
     * Message message = Message.createFrom(intent.getExtras());
     * }
     * </pre>
     *
     * @see Message
     */
    MESSAGE_RECEIVED("org.infobip.mobile.messaging.MESSAGE_RECEIVED"),

    /**
     * It is triggered when messages are sent.
     * <p>
     * Contains messages that were sent and status information for each message.
     * <pre>
     * {@code
     * List<Message> messages = Message.createFrom(intent.getParcelableArrayListExtra(BroadcastParameter.EXTRA_MESSAGES));
     * }
     * </pre>
     *
     * @see Message
     */
    MESSAGES_SENT("org.infobip.mobile.messaging.MESSAGES_SENT"),

    /**
     * It is triggered on every error returned by API.
     * <p>
     * Contains the exception information.
     * <pre>
     * {@code
     * MobileMessagingError mobileMessagingError = (MobileMessagingError) intent.getSerializableExtra(EXTRA_EXCEPTION);
     * }
     * </pre>
     */
    API_COMMUNICATION_ERROR("org.infobip.mobile.messaging.API_COMMUNICATION_ERROR"),

    /**
     * It is triggered when message delivery is reported.
     * <p>
     * Contains the list of all reported message IDs.
     * <pre>
     * {@code
     * String[] messageIDs = intent.getStringArrayExtra(BroadcastParameter.EXTRA_MESSAGE_IDS);
     * }
     * </pre>
     */
    DELIVERY_REPORTS_SENT("org.infobip.mobile.messaging.DELIVERY_REPORTS_SENT"),

    /**
     * It is triggered when message seen is reported.
     * <p>
     * Contains the list of all reported message IDs.
     * <pre>
     * {@code
     * String[] messageIDs = intent.getStringArrayExtra(BroadcastParameter.EXTRA_MESSAGE_IDS);
     * }
     * </pre>
     */
    SEEN_REPORTS_SENT("org.infobip.mobile.messaging.SEEN_REPORTS_SENT"),

    /**
     * It is triggered when notification is displayed in the status bar.
     * <p>
     * Contains message that was sent and notification ID of the displayed notification.
     * Notification ID is -1 if it wasn't displayed. Check logs for those cases.
     * <pre>
     * {@code
     * Message message = Message.createFrom(intent.getExtras());
     * int notificationId = intent.getIntExtra(BroadcastParameter.EXTRA_NOTIFICATION_ID, BroadcastParameter.NOTIFICATION_NOT_DISPLAYED_ID);
     * }
     * </pre>
     * In case you want to cancel notification by notification ID you can use following method:
     * <pre>
     * {@code
     * private void cancelNotification(Context context, int notificationId) {
     *     if (notificationId != BroadcastParameter.NOTIFICATION_NOT_DISPLAYED_ID) {
     *         NotificationManager notificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);
     *         if (notificationManager != null) {
     *             notificationManager.cancel(notificationId);
     *         }
     *     }
     * }
     * }
     * </pre>
     */
    NOTIFICATION_DISPLAYED("org.infobip.mobile.messaging.NOTIFICATION_DISPLAYED"),

    /**
     * It is triggered when notification is tapped.
     * <p>
     * Contains message that was sent.
     * <pre>
     * {@code
     * Message message = Message.createFrom(intent.getExtras());
     * }
     * </pre>
     */
    NOTIFICATION_TAPPED("org.infobip.mobile.messaging.NOTIFICATION_TAPPED"),

    /**
     * It is triggered when user is successfully reported to the server.
     * <pre>
     * {@code
     * User user = User.createFrom(intent.getExtras());
     * }
     * </pre>
     */
    USER_UPDATED("org.infobip.mobile.messaging.USER_UPDATED"),

    /**
     * It is triggered when user is depersonalized on the server.
     */
    DEPERSONALIZED("org.infobip.mobile.messaging.DEPERSONALIZED"),

    /**
     * It is triggered when user is personalized on the server.
     */
    PERSONALIZED("org.infobip.mobile.messaging.PERSONALIZED"),

    /**
     * It is triggered when user's session is sent to the server.
     */
    USER_SESSIONS_SENT("org.infobip.mobile.messaging.USER_SESSIONS_SENT"),

    /**
     * It is triggered when user's custom event is sent to the server.
     */
    CUSTOM_EVENTS_SENT("org.infobip.mobile.messaging.CUSTOM_EVENTS_SENT"),

    /**
     * It is triggered when in-app click events are sent to the server.
     */
    IN_APP_CLICKS_REPORTED("org.infobip.mobile.messaging.IN_APP_CLICKS_REPORTED"),

    /**
     * It is triggered when Google Play Services are not available.
     * <pre>
     * {@code
     * int playServicesErrorCode = intent.getIntExtra(BroadcastParameter.EXTRA_PLAY_SERVICES_ERROR_CODE);
     * }
     * </pre>
     */
    GOOGLE_PLAY_SERVICES_ERROR("org.infobip.mobile.messaging.GOOGLE_PLAY_SERVICES_ERROR");

    private final String key;

    Event(String key) {
        this.key = key;
    }

    public String getKey() {
        return key;
    }
}
